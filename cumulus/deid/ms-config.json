{
  "comment": [
    "This config takes an allow-list approach (vs a deny-list).",
    "The last rule denies everything not previously allowed.",

    "== Style advice ==",
    "In general, please do not blanket-include a BackboneElement, but reference each sub-element directly.",
    "This helps avoid allow-listing too much at once and the awkwardness of redacting one element then keeping the parent node.",
    "When you encounter a polymorphic element (like Condition.onset), beware of freeform string variants.",
    "Please mark such text fields with a comment if kept, to flag that they will need a philter pass.",
    "Each resource's fields are ordered as they appear in the FHIR spec for easier cross-referencing, rather than alphabetical.",

    "== Why we choose to keep as much as we do ==",
    "This config is very greedy as long as it is not grabbing PHI.",
    "For example, we grab Encounter.classHistory and Observation.performer.",
    "It's not clear how or if they will be used, but it's better to have them than not.",
    "It's unrealistic to go back and get the data from the EHR if we decide we do actually want to use the data.",
    "And some of this data may be interesting internally to a hospital for quality checks, aside from study potential."
  ],
  "fhirVersion": "R4",
  "processingErrors": "raise",
  "fhirPathRules": [
    {"comment": "** Only allow a few known extensions **", "path": "xxx", "method": "redact"},
    {"path": "Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex')", "method": "keep"},
    {"path": "Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity')", "method": "keep"},
    {"path": "Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-genderIdentity')", "method": "keep"},
    {"path": "Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-race')", "method": "keep"},
    {"path": "Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-sex-for-clinical-use')", "method": "keep"},
    {"path": "Patient.extension('http://open.epic.com/FHIR/StructureDefinition/extension/sex-for-clinical-use')", "method": "keep", "comment": "Epic has used this pre-final-spec URL"},
    {"path": "nodesByName('modifierExtension')", "method": "keep", "comment": "keep these so we can ignore resources with modifiers we don't understand"},
    {"path": "nodesByType('Extension')", "method": "redact", "comment": "drop all unknown extensions"},

    {"comment": "** Elements that might be embedded and kept elsewhere -- redact pieces of the whole **", "path": "xxx", "method": "redact"},
    {"path": "nodesByType('Age').value", "method": "redact", "comment": "note that this is a partial redaction, only removing ages above 89"},
    {"path": "nodesByType('Attachment').title", "method": "redact"},
    {"path": "nodesByType('Reference').display", "method": "redact"},
    {"path": "nodesByType('Reference').identifier", "method": "redact"},

    {"comment": "** Elements that will be redacted, but we want to keep a small piece of **", "path": "xxx", "method": "redact"},
    {"path": "nodesByType('Address').country", "method": "keep"},
    {"path": "nodesByType('Address').state", "method": "keep"},

    {"comment": "** These PHI-risky elements shouldn't be allow-listed anyway -- but just as a safety measure, explicitly exclude them **", "path": "xxx", "method": "redact"},
    {"path": "nodesByType('Address')", "method": "redact"},
    {"path": "nodesByType('Annotation')", "method": "redact"},
    {"path": "nodesByType('ContactDetail')", "method": "redact"},
    {"path": "nodesByType('ContactPoint')", "method": "redact"},
    {"path": "nodesByType('HumanName')", "method": "redact"},
    {"path": "nodesByType('Identifier')", "method": "redact"},
    {"path": "nodesByType('Narrative')", "method": "redact"},

    {"comment": "** https://www.hl7.org/fhir/condition.html **", "path": "xxx", "method": "redact"},
    {"path": "Condition.clinicalStatus", "method": "keep"},
    {"path": "Condition.verificationStatus", "method": "keep"},
    {"path": "Condition.category", "method": "keep"},
    {"path": "Condition.severity", "method": "keep"},
    {"path": "Condition.code", "method": "keep"},
    {"path": "Condition.bodySite", "method": "keep"},
    {"path": "Condition.subject", "method": "keep"},
    {"path": "Condition.encounter", "method": "keep"},
    {"path": "Condition.onset.ofType(string)", "method": "redact", "comment": "would run philter on it, but it would just remove anything useful we could parse"},
    {"path": "Condition.onset", "method": "keep"},
    {"path": "Condition.abatement.ofType(string)", "method": "redact", "comment": "would run philter on it, but it would just remove anything useful we could parse"},
    {"path": "Condition.abatement", "method": "keep"},
    {"path": "Condition.recorder", "method": "keep"},
    {"path": "Condition.asserter", "method": "keep"},
    {"path": "Condition.recordedDate", "method": "keep"},
    {"path": "Condition.stage.summary", "method": "keep"},
    {"path": "Condition.stage.assessment", "method": "keep"},
    {"path": "Condition.stage.type", "method": "keep"},
    {"path": "Condition.evidence.code", "method": "keep"},
    {"path": "Condition.evidence.detail", "method": "keep"},

    {"comment": "** https://www.hl7.org/fhir/documentreference.html **", "path": "xxx", "method": "redact"},
    {"path": "DocumentReference.status", "method": "keep"},
    {"path": "DocumentReference.docStatus", "method": "keep"},
    {"path": "DocumentReference.type", "method": "keep"},
    {"path": "DocumentReference.category", "method": "keep"},
    {"path": "DocumentReference.subject", "method": "keep"},
    {"path": "DocumentReference.date", "method": "keep"},
    {"path": "DocumentReference.author", "method": "keep"},
    {"path": "DocumentReference.authenticator", "method": "keep"},
    {"path": "DocumentReference.custodian", "method": "keep"},
    {"path": "DocumentReference.relatesTo.code", "method": "keep"},
    {"path": "DocumentReference.relatesTo.target", "method": "keep"},
    {"path": "DocumentReference.securityLabel", "method": "keep"},
    {"path": "DocumentReference.content.attachment", "method": "keep", "comment": "attachments will be dropped later after running NLP on them"},
    {"path": "DocumentReference.content.format", "method": "keep"},
    {"path": "DocumentReference.context.encounter", "method": "keep"},
    {"path": "DocumentReference.context.event", "method": "keep"},
    {"path": "DocumentReference.context.period", "method": "keep"},
    {"path": "DocumentReference.context.facilityType", "method": "keep"},
    {"path": "DocumentReference.context.practiceSetting", "method": "keep"},
    {"path": "DocumentReference.context.sourcePatientInfo", "method": "keep"},
    {"path": "DocumentReference.context.related", "method": "keep"},

    {"comment": "** https://www.hl7.org/fhir/encounter.html **", "path": "xxx", "method": "redact"},
    {"path": "Encounter.status", "method": "keep"},
    {"path": "Encounter.statusHistory.status", "method": "keep"},
    {"path": "Encounter.statusHistory.period", "method": "keep"},
    {"path": "Encounter.class", "method": "keep"},
    {"path": "Encounter.classHistory.class", "method": "keep"},
    {"path": "Encounter.classHistory.period", "method": "keep"},
    {"path": "Encounter.type", "method": "keep"},
    {"path": "Encounter.serviceType", "method": "keep"},
    {"path": "Encounter.priority", "method": "keep"},
    {"path": "Encounter.subject", "method": "keep"},
    {"path": "Encounter.episodeOfCare", "method": "keep"},
    {"path": "Encounter.basedOn", "method": "keep"},
    {"path": "Encounter.participant.type", "method": "keep"},
    {"path": "Encounter.participant.period", "method": "keep"},
    {"path": "Encounter.participant.individual", "method": "keep"},
    {"path": "Encounter.appointment", "method": "keep"},
    {"path": "Encounter.period", "method": "keep"},
    {"path": "Encounter.length", "method": "keep"},
    {"path": "Encounter.reasonCode", "method": "keep"},
    {"path": "Encounter.reasonReference", "method": "keep"},
    {"path": "Encounter.diagnosis.condition", "method": "keep"},
    {"path": "Encounter.diagnosis.use", "method": "keep"},
    {"path": "Encounter.diagnosis.rank", "method": "keep"},
    {"path": "Encounter.account", "method": "keep"},
    {"path": "Encounter.hospitalization.origin", "method": "keep"},
    {"path": "Encounter.hospitalization.admitSource", "method": "keep"},
    {"path": "Encounter.hospitalization.reAdmission", "method": "keep"},
    {"path": "Encounter.hospitalization.dietPreference", "method": "keep"},
    {"path": "Encounter.hospitalization.specialCourtesy", "method": "keep"},
    {"path": "Encounter.hospitalization.specialArrangement", "method": "keep"},
    {"path": "Encounter.hospitalization.destination", "method": "keep"},
    {"path": "Encounter.hospitalization.dischargeDisposition", "method": "keep"},
    {"path": "Encounter.location.location", "method": "keep"},
    {"path": "Encounter.location.status", "method": "keep"},
    {"path": "Encounter.location.physicalType", "method": "keep"},
    {"path": "Encounter.location.period", "method": "keep"},
    {"path": "Encounter.serviceProvider", "method": "keep"},
    {"path": "Encounter.partOf", "method": "keep"},

    {"comment": "** https://www.hl7.org/fhir/observation.html **", "path": "xxx", "method": "redact"},
    {"path": "Observation.basedOn", "method": "keep"},
    {"path": "Observation.partOf", "method": "keep"},
    {"path": "Observation.status", "method": "keep"},
    {"path": "Observation.code", "method": "keep"},
    {"path": "Observation.category", "method": "keep"},
    {"path": "Observation.subject", "method": "keep"},
    {"path": "Observation.focus", "method": "keep"},
    {"path": "Observation.encounter", "method": "keep"},
    {"path": "Observation.effective", "method": "keep"},
    {"path": "Observation.issued", "method": "keep"},
    {"path": "Observation.performer", "method": "keep"},
    {"path": "Observation.value", "method": "keep", "comment": "should run philter on valueString"},
    {"path": "Observation.dataAbsentReason", "method": "keep"},
    {"path": "Observation.interpretation", "method": "keep"},
    {"path": "Observation.bodySite", "method": "keep"},
    {"path": "Observation.method", "method": "keep"},
    {"path": "Observation.specimen", "method": "keep"},
    {"path": "Observation.device", "method": "keep"},
    {"path": "Observation.hasMember", "method": "keep"},
    {"path": "Observation.derivedFrom", "method": "keep"},
    {"path": "Observation.component.code", "method": "keep"},
    {"path": "Observation.component.value", "method": "keep", "comment": "should run philter on valueString"},
    {"path": "Observation.component.dataAbsentReason", "method": "keep"},
    {"path": "Observation.component.interpretation", "method": "keep"},

    {"comment": "** https://www.hl7.org/fhir/patient.html **", "path": "xxx", "method": "redact"},
    {"path": "Patient.active", "method": "keep"},
    {"path": "Patient.gender", "method": "keep"},
    {"path": "Patient.deceased", "method": "keep"},
    {"path": "Patient.maritalStatus", "method": "keep"},
    {"path": "Patient.multipleBirth", "method": "keep"},
    {"path": "Patient.contact.relationship", "method": "keep"},
    {"path": "Patient.contact.gender", "method": "keep"},
    {"path": "Patient.contact.organization", "method": "keep"},
    {"path": "Patient.contact.period", "method": "keep"},
    {"path": "Patient.communication.language", "method": "keep"},
    {"path": "Patient.communication.preferred", "method": "keep"},
    {"path": "Patient.generalPractitioner", "method": "keep"},
    {"path": "Patient.managingOrganization", "method": "keep"},
    {"path": "Patient.link.other", "method": "keep"},
    {"path": "Patient.link.type", "method": "keep"},

    {"comment": "** https://www.hl7.org/fhir/resource.html **", "path": "xxx", "method": "redact"},
    {"path": "Resource.id", "method": "keep"},
    {"path": "Resource.implicitRules", "method": "keep"},
    {"path": "Resource.language", "method": "keep"},
    {"path": "Resource.meta", "method": "keep"},

    {"path": "Resource", "method": "redact", "comment": "Catch-all removal of anything not specifically allowed above"}
  ],
  "parameters": {
    "enablePartialAgesForRedact": true,
    "enablePartialDatesForRedact": true,
    "enablePartialZipCodesForRedact": true,
    "restrictedZipCodeTabulationAreas": [
      "036",
      "059",
      "102",
      "203",
      "205",
      "369",
      "556",
      "692",
      "821",
      "823",
      "878",
      "879",
      "884",
      "893"
    ]
  }
}